#!/bin/bash
set -euo pipefail

# Configuration
THEME_NAME="catppuccin_frappe.theme"

# Get Home Dir and build theme path
HOME_DIR="${HOME:-$(getent passwd "$USER" | cut -d: -f6)}"
THEME_PATH="$HOME_DIR/.config/btop/themes/$THEME_NAME"
THEME="color_theme = \"$THEME_PATH\""

# Validate Theme exists
if [[ ! -f "$THEME_PATH" ]]; then
	echo "Error: Theme not found at path $THEME_PATH" >&2
	echo "Please install the theme or check the path" >&2
	exit 1
fi

# Process Content
content=$(cat)

if echo "$content" | grep -q '^color_theme\s*='; then
	# shellcheck disable=SC2001
	echo "$content" | sed "s|^color_theme\s*=.*|$THEME|"
else
	echo "$content"
	[[ -n "$content" && ! "$content" =~  \n$ ]] && echo
	echo "$THEME"
fi
